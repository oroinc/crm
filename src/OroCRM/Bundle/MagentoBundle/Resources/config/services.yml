parameters:
    # entities
    orocrm_magento.entity.cart.class:                                       OroCRM\Bundle\MagentoBundle\Entity\Cart
    orocrm_magento.entity.cart_address.class:                               OroCRM\Bundle\MagentoBundle\Entity\CartAddress
    orocrm_magento.entity.cart_item.class:                                  OroCRM\Bundle\MagentoBundle\Entity\CartItem
    orocrm_magento.entity.cart_status.class:                                OroCRM\Bundle\MagentoBundle\Entity\CartStatus

    orocrm_magento.entity.customer.class:                                   OroCRM\Bundle\MagentoBundle\Entity\Customer
    orocrm_magento.entity.customer_group.class:                             OroCRM\Bundle\MagentoBundle\Entity\CustomerGroup
    orocrm_magento.entity.address.class:                                    OroCRM\Bundle\MagentoBundle\Entity\Address

    orocrm_magento.entity.order.class:                                      OroCRM\Bundle\MagentoBundle\Entity\Order
    orocrm_magento.entity.order_address.class:                              OroCRM\Bundle\MagentoBundle\Entity\OrderAddress
    orocrm_magento.entity.order_item.class:                                 OroCRM\Bundle\MagentoBundle\Entity\OrderItem

    orocrm_magento.entity.product.class:                                    OroCRM\Bundle\MagentoBundle\Entity\Product
    orocrm_magento.entity.region.class:                                     OroCRM\Bundle\MagentoBundle\Entity\Region
    orocrm_magento.entity.store.class:                                      OroCRM\Bundle\MagentoBundle\Entity\Store
    orocrm_magento.entity.website.class:                                    OroCRM\Bundle\MagentoBundle\Entity\Website

    orocrm_magento.entity.newsletter_subscriber.class:                      OroCRM\Bundle\MagentoBundle\Entity\NewsletterSubscriber

    orocrm_magento.entity.soap_transport.class:                             OroCRM\Bundle\MagentoBundle\Entity\MagentoSoapTransport

    # transport
    orocrm_magento.transport.soap_transport.class:                          OroCRM\Bundle\MagentoBundle\Provider\Transport\SoapTransport

    # providers
    orocrm_magento.provider.channel_type.class:                             OroCRM\Bundle\MagentoBundle\Provider\ChannelType
    orocrm_magento.provider.cart_expiration_processor.class:                OroCRM\Bundle\MagentoBundle\Provider\CartExpirationProcessor
    orocrm_magento.provider.tracking_visit.class:                           OroCRM\Bundle\MagentoBundle\Provider\TrackingVisitProvider

    # forms
    orocrm_magento.form.type.order_place.class:                             OroCRM\Bundle\MagentoBundle\Form\Type\OrderPlaceType
    orocrm_magento.form.type.soap_transport_setting.class:                  OroCRM\Bundle\MagentoBundle\Form\Type\SoapTransportSettingFormType
    orocrm_magento.form.type.soap_transport_check.class:                    OroCRM\Bundle\MagentoBundle\Form\Type\SoapTransportCheckButtonType
    orocrm_magento.form.subscriber.soap_transport_setting.class:            OroCRM\Bundle\MagentoBundle\Form\EventListener\SoapSettingsFormSubscriber
    orocrm_magento.form.type.order_select.class:                            OroCRM\Bundle\MagentoBundle\Form\Type\OrderSelectType
    orocrm_magento.form.type.customer_select.class:                         OroCRM\Bundle\MagentoBundle\Form\Type\CustomerSelectType
    orocrm_magento.form.type.cart_select.class:                             OroCRM\Bundle\MagentoBundle\Form\Type\CartSelectType
    orocrm_magento.form.type.website_select.class:                          OroCRM\Bundle\MagentoBundle\Form\Type\WebsiteSelectType
    orocrm_magento.form.type.customer.class:                                OroCRM\Bundle\MagentoBundle\Form\Type\CustomerType
    orocrm_magento.form.type.customer_group_selector.class:                 OroCRM\Bundle\MagentoBundle\Form\Type\CustomerGroupSelectType
    orocrm_magento.form.type.store_selector.class:                          OroCRM\Bundle\MagentoBundle\Form\Type\StoreSelectType
    orocrm_magento.form.handler.customer.class:                             OroCRM\Bundle\MagentoBundle\Form\Handler\CustomerHandler
    orocrm_magento.form.type.customer_address.class:                        OroCRM\Bundle\MagentoBundle\Form\Type\CustomerAddressType
    orocrm_magento.form.type.customer_channel_selector.class:               OroCRM\Bundle\MagentoBundle\Form\Type\CustomerChannelSelectType
    orocrm_magento.form.type.cart.api.class:                                OroCRM\Bundle\MagentoBundle\Form\Type\CartApiType
    orocrm_magento.form.type.cart_item.api.class:                           OroCRM\Bundle\MagentoBundle\Form\Type\CartItemsApiType
    orocrm_magento.form.type.cart_item_collection.class:                    OroCRM\Bundle\MagentoBundle\Form\Type\CartItemCollectionType
    orocrm_magento.form.type.cart_address.class:                            OroCRM\Bundle\MagentoBundle\Form\Type\CartAddressApiType
    orocrm_magento.form.type.order.api.class:                               OroCRM\Bundle\MagentoBundle\Form\Type\OrderApiType
    orocrm_magento.form.type.order_item_collection.class:                   OroCRM\Bundle\MagentoBundle\Form\Type\OrderItemCollectionType
    orocrm_magento.form.type.order_item.class:                              OroCRM\Bundle\MagentoBundle\Form\Type\OrderItemType
    orocrm_magento.form.type.order_address.api.class:                       OroCRM\Bundle\MagentoBundle\Form\Type\OrderAddressApiType
    orocrm_magento.form.type.order_item.api.class:                          OroCRM\Bundle\MagentoBundle\Form\Type\OrderItemsApiType
    orocrm_magento.form.type.customer.api.class:                            OroCRM\Bundle\MagentoBundle\Form\Type\CustomerApiType
    orocrm_magento.form.type.customer_address.api.class:                    OroCRM\Bundle\MagentoBundle\Form\Type\CustomerAddressApiType

    # event listeners
    orocrm.magento.event_listener.account_widgets_data_grid_listener.class: OroCRM\Bundle\MagentoBundle\EventListener\AccountWidgetsDataGridListener
    orocrm_magento.event_listener.customer_currency.class:                  OroCRM\Bundle\MagentoBundle\EventListener\CustomerCurrencyListener
    orocrm_magento.event_listener.order.class:                              OroCRM\Bundle\MagentoBundle\EventListener\OrderListener
    orocrm_magento.event_listener.channel_owner_set.class:                  OroCRM\Bundle\MagentoBundle\EventListener\ChannelOwnerSetListener
    orocrm_magento.event_listener.writer_error.class:                       OroCRM\Bundle\MagentoBundle\EventListener\IntegrationWriteErrorListener
    orocrm_magento.event_listener.integration_sync_after.class:             OroCRM\Bundle\MagentoBundle\EventListener\IntegrationSyncAfterEventListener
    orocrm_magento.event_listener.update_integration_connectors.class:      OroCRM\Bundle\MagentoBundle\EventListener\UpdateIntegrationConnectorsListener
    orocrm_magento.event_listener.customer_datagrid_listener.class:         OroCRM\Bundle\MagentoBundle\EventListener\CustomerDataGridListener

    # generator
    orocrm_magento.magento_url_generator.class:                             OroCRM\Bundle\MagentoBundle\Service\MagentoUrlGenerator

    #orocrm_magento.customer_address.manager.api.class:                      Oro\Bundle\SoapBundle\Entity\Manager\ApiEntityManager
    orocrm_magento.customer_address.manager.api.class:                      OroCRM\Bundle\MagentoBundle\Entity\Manager\CustomerAddressApiEntityManager
    # datagrid helpers
    orocrm_magento.country.datagrid_helper.class:                           Oro\Bundle\AddressBundle\Datagrid\CountryDatagridHelper
    orocrm_magento.datagrid_helper.class:                                   OroCRM\Bundle\MagentoBundle\Datagrid\MagentoDatagridHelper

    # magento related records delete provider
    orocrm_magento.manager.magento_delete_provider.class:                   OroCRM\Bundle\MagentoBundle\Manager\MagentoDeleteProvider

    # helpers
    orocrm_magento.importexport.address_import_helper.class:                OroCRM\Bundle\MagentoBundle\ImportExport\Strategy\StrategyHelper\AddressImportHelper
    orocrm_magento.importexport.doctrine_helper.class:                      OroCRM\Bundle\MagentoBundle\ImportExport\Strategy\StrategyHelper\DoctrineHelper

    orocrm_magento.state_manager.class:                                     OroCRM\Bundle\MagentoBundle\Service\StateManager
    orocrm_magento.customer_state_handler.class:                            OroCRM\Bundle\MagentoBundle\Service\CustomerStateHandler

    # dashboard
    orocrm_magento.dashboard.data_provider.order.class:                     OroCRM\Bundle\MagentoBundle\Dashboard\OrderDataProvider
    orocrm_magento.dashboard.data_provider.customer.class:                  OroCRM\Bundle\MagentoBundle\Dashboard\CustomerDataProvider
    orocrm_magento.dashboard.data_provider.purchase.class:                  OroCRM\Bundle\MagentoBundle\Dashboard\PurchaseDataProvider

    orocrm_magento.placeholder.filter.class:                                OroCRM\Bundle\MagentoBundle\Placeholder\PlaceholderFilter

    orocrm_magento.provider.phone.address.class:                            OroCRM\Bundle\MagentoBundle\Provider\AddressPhoneProvider
    orocrm_magento.provider.phone.cart_address.class:                       OroCRM\Bundle\MagentoBundle\Provider\CartAddressPhoneProvider
    orocrm_magento.provider.phone.order_address.class:                      OroCRM\Bundle\MagentoBundle\Provider\OrderAddressPhoneProvider
    orocrm_magento.provider.phone.customer.class:                           OroCRM\Bundle\MagentoBundle\Provider\CustomerPhoneProvider

    orocrm_magento.provider.analytics.customer_recency.class:               OroCRM\Bundle\MagentoBundle\Provider\Analytics\CustomerRecencyProvider
    orocrm_magento.provider.analytics.customer_frequency.class:             OroCRM\Bundle\MagentoBundle\Provider\Analytics\CustomerFrequencyProvider
    orocrm_magento.provider.analytics.customer_monetary.class:              OroCRM\Bundle\MagentoBundle\Provider\Analytics\CustomerMonetaryProvider

    orocrm_magento.provider.tracking_customer_identificator.class:          OroCRM\Bundle\MagentoBundle\Provider\TrackingCustomerIdentification
    # Search handlers
    orocrm_magento.form.autocomplete.customer_group.search_handler.class:   OroCRM\Bundle\MagentoBundle\Autocomplete\CustomerGroupSearchHandler
    orocrm_magento.form.autocomplete.store.search_handler.class:            OroCRM\Bundle\MagentoBundle\Autocomplete\StoreSearchHandler

    orocrm_magento.validator.unique_customer_email.class:                   OroCRM\Bundle\MagentoBundle\Validator\UniqueCustomerEmailValidator
    orocrm_magento.validator.start_sync_date.class:                         OroCRM\Bundle\MagentoBundle\Validator\StartSyncDateValidator

    orocrm_magento.security.acl.voter.two_way_sync.class:                   OroCRM\Bundle\MagentoBundle\Acl\Voter\AbstractTwoWaySyncVoter
    orocrm_magento.security.acl.voter.newletter_subscriber.class:           OroCRM\Bundle\MagentoBundle\Acl\Voter\NewsletterSubscriberVoter
    orocrm_magento.security.acl.voter.customer.class:                       OroCRM\Bundle\MagentoBundle\Acl\Voter\CustomerVoter
    orocrm_magento.security.acl.voter.organization.class:                   OroCRM\Bundle\MagentoBundle\Acl\Voter\OrganizationAnnotationVoter

    orocrm_magento.datagrid.customer_actions_provider.class:                OroCRM\Bundle\MagentoBundle\Datagrid\CustomerActionPermissionProvider
    orocrm_magento.datagrid.newsletter_subscriber_provider.class:           OroCRM\Bundle\MagentoBundle\Datagrid\NewsletterSubscriberPermissionProvider

    orocrm_magento.model.newsletter_subscriber_manager.class:               OroCRM\Bundle\MagentoBundle\Model\NewsletterSubscriberManager

    orocrm_magento.service.automatic_discovery.class:                       OroCRM\Bundle\MagentoBundle\Service\AutomaticDiscovery
    orocrm_magento.strategy.automatic_discovery.default.class:              OroCRM\Bundle\MagentoBundle\Service\AutomaticDiscovery\DefaultDiscoveryStrategy
    orocrm_magento.strategy.automatic_discovery.addresses.class:            OroCRM\Bundle\MagentoBundle\Service\AutomaticDiscovery\AddressDiscoveryStrategy
    orocrm_magento.action.automatic_discovery.class:                        OroCRM\Bundle\MagentoBundle\Model\Action\AutomaticDiscoveryAction

    orocrm_magento.wsdl_manager.class:                                      OroCRM\Bundle\MagentoBundle\Service\WsdlManager
    orocrm_magento.wsdl.cache_clearer.class:                                OroCRM\Bundle\MagentoBundle\Cache\WsdlCacheClearer
    orocrm_magento.integration_entity.remove_listener.class:                OroCRM\Bundle\MagentoBundle\EventListener\IntegrationRemoveListener
    orocrm_magento.wsdl.guzzle_client.class:                                Guzzle\Http\Client

    orocrm_magento.provider.big_number.class:                               OroCRM\Bundle\MagentoBundle\Provider\MagentoBigNumberProvider

    orocrm_magento.model.channel_settings_provider.class:                   OroCRM\Bundle\MagentoBundle\Model\ChannelSettingsProvider

    orocrm_magento.service.information_loader.class:                        OroCRM\Bundle\MagentoBundle\Service\InformationLoader

    # managers
    orocrm_magento.cart.manager.api.class:                                  OroCRM\Bundle\MagentoBundle\Entity\Manager\CartApiEntityManager
    orocrm_magento.cart_address.manager.api.class:                          OroCRM\Bundle\MagentoBundle\Entity\Manager\CartAddressApiEntityManager
    orocrm_magento.cart_item.manager.api.class:                             OroCRM\Bundle\MagentoBundle\Entity\Manager\CartItemApiEntityManager
    orocrm_magento.order.manager.api.class:                                 OroCRM\Bundle\MagentoBundle\Entity\Manager\OrderApiEntityManager
    orocrm_magento.order_item.manager.api.class:                            OroCRM\Bundle\MagentoBundle\Entity\Manager\OrderItemApiEntityManager
    orocrm_magento.order_address.manager.api.class:                         OroCRM\Bundle\MagentoBundle\Entity\Manager\OrderAddressApiEntityManager
    orocrm_magento.customer.manager.api.class:                              OroCRM\Bundle\MagentoBundle\Entity\Manager\CustomerApiEntityManager

    # handlers
    orocrm_magento.form.handler.cart.api.class:                             OroCRM\Bundle\MagentoBundle\Form\Handler\CartHandler
    orocrm_magento.form.handler.cart_address.class:                         OroCRM\Bundle\MagentoBundle\Form\Handler\CartAddressHandler
    orocrm_magento.form.handler.cart_item.class:                            OroCRM\Bundle\MagentoBundle\Form\Handler\CartItemHandler
    orocrm_magento.form.handler.order.class:                                OroCRM\Bundle\MagentoBundle\Form\Handler\OrderHandler
    orocrm_magento.form.handler.order_address.api.class:                    OroCRM\Bundle\MagentoBundle\Form\Handler\OrderAddressApiHandler
    orocrm_magento.form.handler.order_item.class:                           OroCRM\Bundle\MagentoBundle\Form\Handler\OrderItemHandler
    orocrm_magento.form.api.handler.customer.class:                         OroCRM\Bundle\MagentoBundle\Form\Handler\CustomerApiHandler
    orocrm_magento.form.handler.customer_address.class:                     OroCRM\Bundle\MagentoBundle\Form\Handler\CustomerAddressApiHandler

services:
    orocrm_magento.transport.soap_transport:
        class: %orocrm_magento.transport.soap_transport.class%
        arguments:
            - "@oro_security.encoder.mcrypt"
            - "@orocrm_magento.wsdl_manager"
            - []
        tags:
            - { name: oro_integration.transport, type: magento_soap, channel_type: magento }
            - { name: orocrm_magento.bundle_config.aware, argument_number: 2 }
        calls:
            - [setLogger, ["@oro_integration.logger.strategy"]]

    # Providers
    orocrm_magento.provider.channel_type:
        class: %orocrm_magento.provider.channel_type.class%
        tags:
            - { name: oro_integration.channel, type: magento }

    orocrm_magento.provider.cart_expiration_processor:
        class: %orocrm_magento.provider.cart_expiration_processor.class%
        arguments:
            - "@oro_integration.provider.connector_context_mediator"
            - "@doctrine.orm.entity_manager"

    orocrm_magento.provider.tracking_visit:
        class: %orocrm_magento.provider.tracking_visit.class%
        arguments:
            - "@doctrine"
            - "@oro_security.acl_helper"

    # forms
    orocrm_magento.form.subscriber.soap_transport_setting:
        class: %orocrm_magento.form.subscriber.soap_transport_setting.class%
        arguments:
            - "@oro_security.encoder.mcrypt"

    orocrm_magento.form.type.soap_transport_setting:
        class: %orocrm_magento.form.type.soap_transport_setting.class%
        arguments:
            - "@orocrm_magento.transport.soap_transport"
            - "@orocrm_magento.form.subscriber.soap_transport_setting"
            - "@oro_integration.manager.types_registry"
        tags:
            - { name: form.type, alias: orocrm_magento_soap_transport_setting_form_type }

    orocrm_magento.form.type.soap_transport_check:
        class: %orocrm_magento.form.type.soap_transport_check.class%
        tags:
            - { name: form.type, alias: orocrm_magento_soap_transport_check_button }

    orocrm_magento.form.type.order_select:
        class: %orocrm_magento.form.type.order_select.class%
        tags:
            - { name: form.type, alias: orocrm_order_select }

    orocrm_magento.form.type.customer_select:
        class: %orocrm_magento.form.type.customer_select.class%
        tags:
            - { name: form.type, alias: orocrm_customer_select }

    orocrm_magento.form.type.cart_select:
        class: %orocrm_magento.form.type.cart_select.class%
        tags:
            - { name: form.type, alias: orocrm_cart_select }

    orocrm_magento.form.type.website_select:
        class: %orocrm_magento.form.type.website_select.class%
        tags:
            - { name: form.type, alias: orocrm_magento_website_select }

    orocrm_magento.form.type.order_place:
        class: %orocrm_magento.form.type.order_place.class%
        tags:
            - { name: form.type, alias: orocrm_magento_order_place_form_type }

    orocrm_magento.form.type.customer:
        class: %orocrm_magento.form.type.customer.class%
        arguments:
            - %orocrm_magento.entity.customer.class%
            - %orocrm_magento.entity.address.class%
        tags:
            - { name: form.type, alias: orocrm_magento_customer }

    orocrm_magento.form.type.customer_address:
        class: %orocrm_magento.form.type.customer_address.class%
        tags:
            - { name: form.type, alias: orocrm_magento_customer_addresses }

    orocrm_magento.form.type.customer_group_selector:
        class: %orocrm_magento.form.type.customer_group_selector.class%
        tags:
            - { name: form.type, alias: orocrm_magento_customer_group_select }

    orocrm_magento.form.type.store_selector:
        class: %orocrm_magento.form.type.store_selector.class%
        tags:
            - { name: form.type, alias: orocrm_magento_store_select }

    orocrm_magento.form.type.customer_channel_selector:
        class: %orocrm_magento.form.type.customer_channel_selector.class%
        arguments:
            - '@orocrm_channel.provider.channels_by_entities'
        calls:
            - [setChannelClass, [%orocrm_channel.entity.class%]]
        tags:
            - { name: form.type, alias: orocrm_magento_customer_channel_select }

    orocrm_magento.form.handler.customer:
        class: %orocrm_magento.form.handler.customer.class%
        parent: oro_form.model.update_handler
        scope: request
        calls:
            - [setStateHandler,  ["@orocrm_magento.customer_state_handler"]]

    orocrm_magento.form.cart.api:
        class: Symfony\Component\Form\Form
        factory_method: createNamed
        factory_service: form.factory
        arguments:
            - ~
            - 'cart_api_type'

    orocrm_magento.form.type.cart.api:
        class: %orocrm_magento.form.type.cart.api.class%
        tags:
            - { name: form.type, alias: cart_api_type }

    orocrm_magento.form.type.cart_item_collection:
        class: %orocrm_magento.form.type.cart_item_collection.class%
        tags:
             - { name: form.type, alias: orocrm_cart_item_collection }

    orocrm_magento.form.cart_item.api:
        class: Symfony\Component\Form\Form
        factory_method: createNamed
        factory_service: form.factory
        arguments:
            - ~
            - 'cart_item_api_type'

    orocrm_magento.form.type.cart_item.api:
        class: %orocrm_magento.form.type.cart_item.api.class%
        tags:
            - { name: form.type, alias: cart_item_api_type }

    orocrm_magento.form.cart_address.api:
        class: Symfony\Component\Form\Form
        factory_method: createNamed
        factory_service: form.factory
        arguments:
            - ~
            - 'cart_address_api_type'

    orocrm_magento.form.type.cart_address:
        class: %orocrm_magento.form.type.cart_address.class%
        tags:
             - { name: form.type, alias: cart_address_api_type }

    orocrm_magento.form.order.api:
        class: Symfony\Component\Form\Form
        factory_method: createNamed
        factory_service: form.factory
        arguments:
            - ~
            - "order_api_type"

    orocrm_magento.form.type.order.api:
        class: %orocrm_magento.form.type.order.api.class%
        arguments:
            - %orocrm_magento.entity.order.class%
        tags:
            - { name: form.type, alias: order_api_type }

    orocrm_magento.form.type.order_item_collection:
        class: %orocrm_magento.form.type.order_item_collection.class%
        tags:
             - { name: form.type, alias: orocrm_order_item_collection }

    orocrm_magento.form.type.order_item:
        class: %orocrm_magento.form.type.order_item.class%
        tags:
             - { name: form.type, alias: orocrm_order_item }

    orocrm_magento.form.type.order_address.api:
        class: %orocrm_magento.form.type.order_address.api.class%
        tags:
            - { name: form.type, alias: order_address_api_type }

    orocrm_magento.form.order_address.api:
        class: Symfony\Component\Form\Form
        factory_method: createNamed
        factory_service: form.factory
        arguments:
            - ~
            - 'order_address_api_type'

    orocrm_magento.form.type.order_item.api:
        class: %orocrm_magento.form.type.order_item.api.class%
        tags:
            - { name: form.type, alias: order_item_api_type }

    orocrm_magento.form.order_item.api:
        class: Symfony\Component\Form\Form
        factory_method: createNamed
        factory_service: form.factory
        arguments:
            - ~
            - 'order_item_api_type'

    orocrm_magento.form.type.customer.api:
        class: %orocrm_magento.form.type.customer.api.class%
        arguments:
            - %orocrm_magento.entity.customer.class%
        tags:
            - { name: form.type, alias: api_customer_type }

    orocrm_magento.form.customer.api:
        class: Symfony\Component\Form\Form
        factory_method: createNamed
        factory_service: form.factory
        arguments:
            - ~
            - "api_customer_type"

    orocrm_magento.form.customer_address.api:
        class: Symfony\Component\Form\Form
        factory_method: createNamed
        factory_service: form.factory
        arguments:
            - ~
            - "customer_address_api_type"

    orocrm_magento.form.type.customer_address.api:
        class: %orocrm_magento.form.type.customer_address.api.class%
        arguments:
            - %orocrm_magento.entity.customer.class%
        tags:
            - { name: form.type, alias: customer_address_api_type }

    # Search handler
    orocrm_magento.form.autocomplete.order.search_handler:
        parent: oro_form.autocomplete.search_handler
        arguments:
            - %orocrm_magento.order.entity.class%
            - ["incrementId"]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: orocrm_magento.orders, acl_resource: orocrm_magento_order_view }
        lazy: true

    orocrm_magento.form.autocomplete.customer.search_handler:
        parent: oro_form.autocomplete.full_name.search_handler
        arguments:
            - %orocrm_magento.customer.entity.class%
            - ["namePrefix", "firstName", "middleName", "lastName", "nameSuffix"]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: orocrm_magento.customers, acl_resource: orocrm_magento_customer_view }
        lazy: true

    orocrm_magento.form.autocomplete.cart.search_handler:
        parent: oro_form.autocomplete.search_handler
        arguments:
            - %orocrm_magento.cart.entity.class%
            - ["originId"]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: orocrm_magento.carts, acl_resource: orocrm_magento_cart_view }
        lazy: true

    # event listeners
    orocrm_magento.event_listener.order_grid:
        class: OroCRM\Bundle\MagentoBundle\EventListener\OrderGridListener
        arguments:
            - "@orocrm_magento.country.datagrid_helper"
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.before.magento-order-grid, method: onBuildBefore }

    orocrm_magento.event_listener.customer_currency:
        class: %orocrm_magento.event_listener.customer_currency.class%
        calls:
            - [setContainer, ["@service_container"]]
        tags:
            - { name: doctrine.event_listener, event: prePersist }

    orocrm_magento.event_listener.order:
        class: %orocrm_magento.event_listener.order.class%
        arguments:
            - "@orocrm_channel.event_listener.doctrine"
        tags:
            - { name: doctrine.event_listener, event: prePersist }
            - { name: doctrine.event_listener, event: preUpdate }
            - { name: doctrine.event_listener, event: postFlush, priority: 5 }

    orocrm_magento.event_listener.customer_order_grid_listener:
        class: %orocrm.magento.event_listener.account_widgets_data_grid_listener.class%
        arguments:
            - ['customerId', 'channelId']
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.after.magento-customer-order-grid, method: onBuildAfter }
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.after.magento-customer-cart-grid, method: onBuildAfter }
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.after.magento-customer-orders-widget-grid, method: onBuildAfter }
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.after.magento-customer-cart-widget-grid, method: onBuildAfter }

    orocrm_magento.event_listener.channel_owner_set:
        class: %orocrm_magento.event_listener.channel_owner_set.class%
        arguments:
            - "@doctrine.orm.default_entity_manager"
        tags:
            - { name: kernel.event_listener, event: oro_integration.default_owner.set, method: onSet }

    orocrm_magento.event_listener.update_integration_connectors:
        class: %orocrm_magento.event_listener.update_integration_connectors.class%
        arguments:
            - "@orocrm_channel.provider.settings_provider"
            - "@doctrine"
        calls:
            - [setConnectorsTypeRegistry,  ["@oro_integration.manager.types_registry"]]
        tags:
            - { name: kernel.event_listener, event: orocrm_channel.channel.save_succeed, method: onChannelSave, priority: -10 }

    orocrm_magento.event_listener.writer_error:
        class: %orocrm_magento.event_listener.writer_error.class%
        tags:
            - { name: kernel.event_listener, event: oro_integration.writer_error, method: handleError }

    orocrm_magento.service.magento_url_generator:
        class: %orocrm_magento.magento_url_generator.class%
        arguments:
            - "@router"
        scope: prototype

    orocrm_magento.event_listener.after_job_execution:
        class: %orocrm_magento.event_listener.integration_sync_after.class%
        tags:
            - { name: kernel.event_listener, event: oro_integration.event.sync_after, method: process }

    orocrm_magento.event_listener.customer_datagrid_listener:
        class: %orocrm_magento.event_listener.customer_datagrid_listener.class%
        arguments:
            - "@request_stack"
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.pre.magento-customers-grid, method: onPreBuild, priority: 255 }

    # Customer API
    orocrm_magento.customer_address.manager.api:
        class: %orocrm_magento.customer_address.manager.api.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orocrm_magento.entity.address.class%
            - "@doctrine.orm.entity_manager"

    orocrm_magento.customer.manager.api:
        class: %orocrm_magento.customer.manager.api.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orocrm_magento.entity.customer.class%
            - "@doctrine.orm.entity_manager"

    orocrm_magento.customer_birthday_type_transformer:
        class: OroCRM\Bundle\MagentoBundle\Form\DataTransformer\BirthdayTypeApiTransformer

    orocrm_magento.datagrid_helper:
        class: %orocrm_magento.datagrid_helper.class%

    orocrm_magento.country.datagrid_helper:
        class: %orocrm_magento.country.datagrid_helper.class%

    orocrm_magento.manager.magento_delete_provider:
        class: %orocrm_magento.manager.magento_delete_provider.class%
        arguments:
            - "@doctrine.orm.entity_manager"
        tags:
            - { name: oro_integration.delete_provider }

    orocrm_magento.importexport.address_import_helper:
        class: %orocrm_magento.importexport.address_import_helper.class%
        arguments:
            - "@orocrm_magento.importexport.doctrine_helper"

    orocrm_magento.importexport.doctrine_helper:
        class: %orocrm_magento.importexport.doctrine_helper.class%
        arguments:
            - "@oro_importexport.strategy.import.helper"

    orocrm_magento.dashboard.data_provider.order:
        class: %orocrm_magento.dashboard.data_provider.order.class%
        arguments:
            - "@doctrine"
            - "@oro_security.acl_helper"
            - "@oro_chart.config_provider"
            - "@oro_locale.formatter.date_time"
            - "@oro_dashboard.datetime.helper"

    orocrm_magento.dashboard.data_provider.customer:
        class: %orocrm_magento.dashboard.data_provider.customer.class%
        arguments:
            - '@doctrine'
            - '@oro_security.acl_helper'
            - '@oro_chart.config_provider'
            - '@oro_dashboard.datetime.helper'

    orocrm_magento.dashboard.data_provider.purchase:
        class: %orocrm_magento.dashboard.data_provider.purchase.class%
        arguments:
            - '@doctrine'
            - '@oro_chart.config_provider'
            - '@orocrm_magento.provider.tracking_visit'
            - '@translator'
            - '@oro_security.acl_helper'
            - '@oro_dashboard.filter.date_filter_processor'

    orocrm_magento.placeholder.filter:
        class: %orocrm_magento.placeholder.filter.class%

    orocrm_magento.provider.enitity_state:
        parent: orocrm_channel.provider.utils.entity_state_provider
        arguments:
            - 'OroCRM\Bundle\MagentoBundle\Entity'

    orocrm_magento.provider.phone.address:
        class: %orocrm_magento.provider.phone.address.class%
        tags:
            - { name: oro_address.phone_provider, class: %orocrm_magento.entity.address.class% }

    orocrm_magento.provider.phone.cart_address:
        class: %orocrm_magento.provider.phone.cart_address.class%
        tags:
            - { name: oro_address.phone_provider, class: %orocrm_magento.entity.cart_address.class% }

    orocrm_magento.provider.phone.order_address:
        class: %orocrm_magento.provider.phone.order_address.class%
        tags:
            - { name: oro_address.phone_provider, class: %orocrm_magento.entity.order_address.class% }

    orocrm_magento.provider.phone.customer:
        class: %orocrm_magento.provider.phone.customer.class%
        tags:
            - { name: oro_address.phone_provider, class: %orocrm_magento.entity.customer.class% }

    orocrm_magento.provider.analytics.customer_recency:
        class: %orocrm_magento.provider.analytics.customer_recency.class%
        arguments:
            - "@oro_entity.doctrine_helper"
            - %orocrm_magento.entity.customer.class%
        tags:
            - { name: orocrm_analytics.builder.rfm }

    orocrm_magento.provider.analytics.customer_frequency:
        class: %orocrm_magento.provider.analytics.customer_frequency.class%
        arguments:
            - "@oro_entity.doctrine_helper"
            - %orocrm_magento.entity.customer.class%
        tags:
            - { name: orocrm_analytics.builder.rfm }

    orocrm_magento.provider.analytics.customer_monetary:

        class: %orocrm_magento.provider.analytics.customer_monetary.class%
        arguments:
            - "@oro_entity.doctrine_helper"
            - %orocrm_magento.entity.customer.class%
        tags:
            - { name: orocrm_analytics.builder.rfm }

    orocrm_magento.provider.tracking_customer_identificator:
        class: %orocrm_magento.provider.tracking_customer_identificator.class%
        arguments:
           - "@doctrine"
           - "@oro_entity_config.provider.extend"
           - "@orocrm_channel.provider.settings_provider"
        tags:
           - {name: oro_tracking.provider.identification, priority: 10}

    # Search handlers
    orocrm_magento.form.autocomplete.customer_group.search_handler:
        class: %orocrm_magento.form.autocomplete.customer_group.search_handler.class%
        arguments:
            - %orocrm_magento.entity.customer_group.class%
            - ["name"]
        calls:
            - [initDoctrinePropertiesByManagerRegistry,  ["@doctrine"]]
            - [setAclHelper,["@oro_security.acl_helper"]]
            - [setDataChannelClass, [%orocrm_channel.entity.class%]]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: "magento_customer_group", acl_resource: "orocrm_magento_customer_view" }

    orocrm_magento.form.autocomplete.store.search_handler:
        class: %orocrm_magento.form.autocomplete.store.search_handler.class%
        arguments:
            - %orocrm_magento.entity.store.class%
            - ["name"]
        calls:
            - [initDoctrinePropertiesByManagerRegistry,  ["@doctrine"]]
            - [setAclHelper,["@oro_security.acl_helper"]]
            - [setDataChannelClass, [%orocrm_channel.entity.class%]]
        tags:
            - { name: oro_form.autocomplete.search_handler, alias: "magento_store", acl_resource: "orocrm_magento_customer_view" }

    orocrm_magento.validator.unique_customer_email:
        class: %orocrm_magento.validator.unique_customer_email.class%
        arguments:
            - "@orocrm_magento.transport.soap_transport"
        tags:
            - { name: validator.constraint_validator, alias: orocrm_magento.validator.unique_customer_email }

    orocrm_magento.validator.start_sync_date:
        class: %orocrm_magento.validator.start_sync_date.class%
        arguments:
            - "@doctrine"
        tags:
            - { name: validator.constraint_validator, alias: orocrm_magento.validator.start_sync_date }

    orocrm_magento.security.acl.voter.two_way_sync:
        class: %orocrm_magento.security.acl.voter.two_way_sync.class%
        abstract: true
        arguments:
            - "@oro_entity.doctrine_helper"
        calls:
            - [setSettingsProvider,  ["@orocrm_magento.model.channel_settings_provider"]]

    orocrm_magento.security.acl.voter.customer:
        class: %orocrm_magento.security.acl.voter.customer.class%
        parent: orocrm_magento.security.acl.voter.two_way_sync
        calls:
            - [setClassName, [%orocrm_magento.entity.customer.class%]]
        tags:
            - { name: security.voter, priority: 500 }

    orocrm_magento.security.acl.voter.newletter_subscriber:
        class: %orocrm_magento.security.acl.voter.newletter_subscriber.class%
        parent: orocrm_magento.security.acl.voter.two_way_sync
        calls:
            - [setClassName, [%orocrm_magento.entity.newsletter_subscriber.class%]]
        tags:
            - { name: security.voter, priority: 500 }

    orocrm_magento.security.acl.voter.organization:
        class: %orocrm_magento.security.acl.voter.organization.class%
        parent: orocrm_magento.security.acl.voter.two_way_sync
        calls:
            - [setClassName, [%oro_organization.organization.entity.class%]]
        tags:
            - { name: security.voter, priority: 600 }

    orocrm_magento.datagrid.customer_actions_provider:
        class: %orocrm_magento.datagrid.customer_actions_provider.class%
        parent: orocrm_magento.datagrid.newsletter_subscriber_provider
        arguments:
            - "@orocrm_magento.model.channel_settings_provider"

    orocrm_magento.state_manager:
        class: %orocrm_magento.state_manager.class%

    orocrm_magento.customer_state_handler:
        class: %orocrm_magento.customer_state_handler.class%
        arguments:
            - "@orocrm_magento.state_manager"

    orocrm_magento.datagrid.newsletter_subscriber_provider:
        class: %orocrm_magento.datagrid.newsletter_subscriber_provider.class%
        arguments:
            - "@orocrm_magento.model.channel_settings_provider"
        calls:
            - [setSecurityFacade,  ["@oro_security.security_facade"]]

    orocrm_magento.model.newsletter_subscriber_manager:
        class: %orocrm_magento.model.newsletter_subscriber_manager.class%
        arguments:
            - "@oro_entity.doctrine_helper"

    orocrm_magento.strategy.automatic_discovery.default:
        class: %orocrm_magento.strategy.automatic_discovery.default.class%

    orocrm_magento.strategy.automatic_discovery.addresses:
        class: %orocrm_magento.strategy.automatic_discovery.addresses.class%

    orocrm_magento.service.automatic_discovery:
        class: %orocrm_magento.service.automatic_discovery.class%
        arguments:
            - "@oro_entity.doctrine_helper"
            - "@orocrm_magento.strategy.automatic_discovery.default"
            - "@oro_security.owner.ownership_metadata_provider"
            - %orocrm_magento.customer.entity.class%
            - []
        calls:
            - [addStrategy, ['addresses', "@orocrm_magento.strategy.automatic_discovery.addresses"]]
        tags:
            - { name: orocrm_magento.bundle_config.aware, argument_number: 4 }

    orocrm_magento.action.automatic_discovery:
        class: %orocrm_magento.action.automatic_discovery.class%
        arguments:
            - "@oro_workflow.context_accessor"
            - "@orocrm_magento.service.automatic_discovery"
        tags:
            - { name: oro_workflow.action, alias: automatic_discovery }

    orocrm_magento.wsdl.guzzle_client:
        class: %orocrm_magento.wsdl.guzzle_client.class%
        lazy: true

    orocrm_magento.wsdl_manager:
        class: %orocrm_magento.wsdl_manager.class%
        arguments:
            - "@filesystem"
            - "@orocrm_magento.wsdl.guzzle_client"
            - %kernel.cache_dir%
            - []
        tags:
            - { name: orocrm_magento.bundle_config.aware, argument_number: 3 }

    orocrm_magento.wsdl.cache_clearer:
        public: false
        class: %orocrm_magento.wsdl.cache_clearer.class%
        arguments:
            - "@orocrm_magento.wsdl_manager"
        tags:
            - { name: kernel.cache_clearer,  priority: 30 }

    orocrm_magento.integration_entity.remove_listener:
        class: %orocrm_magento.integration_entity.remove_listener.class%
        arguments:
            - "@orocrm_magento.wsdl_manager"
        tags:
            - { name: doctrine.event_listener, event: preRemove }

    orocrm_magento.model.channel_settings_provider:
        class: %orocrm_magento.model.channel_settings_provider.class%
        arguments:
            - "@oro_entity.doctrine_helper"
            - %oro_integration.entity.class%

    orocrm_magento.provider.big_number:
        class: %orocrm_magento.provider.big_number.class%
        arguments:
            - "@doctrine"
            - "@oro_security.acl_helper"
            - "@oro_dashboard.provider.big_number.date_helper"
        tags:
            - { name: oro_dashboard.big_number.provider, alias: magento }

    orocrm_magento.service.order.information_loader:
        class: %orocrm_magento.service.information_loader.class%
        arguments:
            - "@oro_importexport.job_executor"
            - "@orocrm_magento.mage.order_connector"
            - "orocrm_magento.add_or_update_order"

    orocrm_magento.service.cart.information_loader:
        class: %orocrm_magento.service.information_loader.class%
        arguments:
            - "@oro_importexport.job_executor"
            - "@orocrm_magento.mage.cart_connector"
            - "orocrm_magento.add_or_update_cart"

    # manager
    orocrm_magento.cart.manager.api:
        class: %orocrm_magento.cart.manager.api.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orocrm_magento.entity.cart.class%
            - "@doctrine.orm.entity_manager"

    orocrm_magento.cart_address.manager.api:
        class: %orocrm_magento.cart_address.manager.api.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orocrm_magento.entity.cart_address.class%
            - "@doctrine.orm.entity_manager"

    orocrm_magento.cart_item.manager.api:
        class: %orocrm_magento.cart_item.manager.api.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orocrm_magento.entity.cart_item.class%
            - "@doctrine.orm.entity_manager"

    orocrm_magento.order.manager.api:
        class: %orocrm_magento.order.manager.api.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orocrm_magento.entity.order.class%
            - "@doctrine.orm.entity_manager"

    orocrm_magento.order_item.manager.api:
        class: %orocrm_magento.order_item.manager.api.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orocrm_magento.entity.order_item.class%
            - "@doctrine.orm.entity_manager"

    orocrm_magento.order_address.manager.api:
        class: %orocrm_magento.order_address.manager.api.class%
        parent: oro_soap.manager.entity_manager.abstract
        arguments:
            - %orocrm_magento.entity.order_address.class%
            - "@doctrine.orm.entity_manager"

    # handler
    orocrm_magento.form.handler.cart.api:
        class: %orocrm_magento.form.handler.cart.api.class%
        scope: request
        arguments:
            - "@orocrm_magento.form.cart.api"
            - "@request"
            - "@doctrine"
            - "@security.context"

    orocrm_magento.form.handler.cart_address:
        class: %orocrm_magento.form.handler.cart_address.class%
        scope: request
        arguments:
            - "@orocrm_magento.form.cart_address.api"
            - "@request"
            - "@doctrine"
            - "@security.context"

    orocrm_magento.form.handler.cart_item:
        class: %orocrm_magento.form.handler.cart_item.class%
        scope: request
        arguments:
            - "@orocrm_magento.form.cart_item.api"
            - "@request"
            - "@doctrine"

    orocrm_magento.form.handler.order.api:
        class: %orocrm_magento.form.handler.order.class%
        scope: request
        arguments:
            - "@orocrm_magento.form.order.api"
            - "@request"
            - "@doctrine"
            - "@security.context"

    orocrm_magento.form.handler.order_item:
        class: %orocrm_magento.form.handler.order_item.class%
        scope: request
        arguments:
            - "@orocrm_magento.form.order_item.api"
            - "@request"
            - "@doctrine"

    orocrm_magento.form.handler.order_address.api:
        class: %orocrm_magento.form.handler.order_address.api.class%
        scope: request
        arguments:
            - "@orocrm_magento.form.order_address.api"
            - "@request"
            - "@doctrine.orm.entity_manager"
            - "@security.context"

    orocrm_magento.form.handler.customer.api:
        class: %orocrm_magento.form.api.handler.customer.class%
        scope: request
        arguments:
            - "@orocrm_magento.form.customer.api"
            - "@request"
            - "@doctrine"
            - "@security.context"

    orocrm_magento.form.api.handler.customer_address:
        class: %orocrm_magento.form.handler.customer_address.class%
        scope: request
        arguments:
            - "@orocrm_magento.form.customer_address.api"
            - "@request"
            - "@doctrine"
            - "@security.context"

    orocrm_magento.routing.options_resolver.old_options:
        class: OroCRM\Bundle\MagentoBundle\Routing\OldOptionsRouteOptionsResolver
        public: false
        tags:
            - { name: routing.options_resolver }

    orocrm_magento.manager.abandoned_shopping_cart_flow:
        parent: oro_workflow.abstract.workflow_aware_manager
        calls:
            - ['setWorkflowName', ['b2c_flow_abandoned_shopping_cart']]
