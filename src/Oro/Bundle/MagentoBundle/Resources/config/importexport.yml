services:
    # Data converter
    oro_magento.importexport.data_converter.cartitem:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\CartItemDataConverter

    oro_magento.importexport.data_converter.cart_address:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\CartAddressDataConverter
        parent: oro_magento.importexport.data_converter.abstract_address

    oro_magento.importexport.data_converter.cart:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\CartDataConverter
        calls:
            - [addNodeDataConverter, ['shipping_address', "@oro_magento.importexport.data_converter.cart_address"]]
            - [addNodeDataConverter, ['billing_address', "@oro_magento.importexport.data_converter.cart_address"]]
            - [addNodeDataConverter, ['items', "@oro_magento.importexport.data_converter.cartitem", true]]

    oro_magento.importexport.data_converter.order_address:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\OrderAddressDataConverter
        parent: oro_magento.importexport.data_converter.abstract_address

    oro_magento.importexport.data_converter.order_item:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\OrderItemDataConverter

    oro_magento.importexport.data_converter.order_notes:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\OrderNotesDataConverter
        public: false

    oro_magento.importexport.data_converter.order:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\OrderDataConverter
        calls:
            - [addNodeDataConverter, ['shipping_address', "@oro_magento.importexport.data_converter.order_address"]]
            - [addNodeDataConverter, ['billing_address', "@oro_magento.importexport.data_converter.order_address"]]
            - [addNodeDataConverter, ['items', "@oro_magento.importexport.data_converter.order_item", true]]
            - [addNodeDataConverter, ['status_history', "@oro_magento.importexport.data_converter.order_notes", true]]

    oro_magento.importexport.data_converter.customer_address:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\CustomerAddressDataConverter
        parent: oro_magento.importexport.data_converter.abstract_address

    oro_magento.importexport.data_converter.website:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\WebsiteDataConverter

    oro_magento.importexport.data_converter.store:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\StoreDataConverter

    oro_magento.importexport.data_converter.rest.store:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\Rest\StoreDataConverter

    oro_magento.importexport.data_converter.customer_group:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\CustomerGroupDataConverter

    oro_magento.importexport.data_converter.customer:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\CustomerDataConverter
        arguments:
            - "@oro_entity.helper.field_helper"
        calls:
            - [addNodeDataConverter, ['addresses', "@oro_magento.importexport.data_converter.customer_address", true]]
            - [addNodeDataConverter, ['group', "@oro_magento.importexport.data_converter.customer_group"]]

    oro_magento.importexport.data_converter.newsletter_subscriber:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\NewsletterSubscriberDataConverter
        calls:
            - [addNodeDataConverter, ['store', "@oro_magento.importexport.data_converter.store"]]

    oro_magento.importexport.data_converter.guest_customer:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\GuestCustomerDataConverter

    oro_magento.importexport.data_converter.credit_memo_item:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\CreditMemoItemDataConverter

    oro_magento.importexport.data_converter.credit_memo:
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\CreditMemoDataConverter
        calls:
            - [addNodeDataConverter, ['items', "@oro_magento.importexport.data_converter.credit_memo_item", true]]

    # Connectors
    oro_magento.connector.abstract:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\AbstractMagentoConnector
        abstract: true
        arguments:
            - "@oro_importexport.context_registry"
            - "@oro_integration.logger.strategy"
            - "@oro_integration.provider.connector_context_mediator"
            - []
        calls:
            - [setManagerRegistry, ["@doctrine"]]

    oro_magento.mage.website:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\WebsiteConnector
        parent: oro_magento.connector.abstract
        calls:
            - [setClassName, ['Oro\Bundle\MagentoBundle\Entity\Website']]
        tags:
            - { name: oro_integration.connector, type: website_dictionary, channel_type: magento }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.rest.website:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\Rest\WebsiteConnector
        parent: oro_magento.connector.abstract
        calls:
            - [setClassName, ['Oro\Bundle\MagentoBundle\Entity\Website']]
        tags:
            - { name: oro_integration.connector, type: website_dictionary, channel_type: magento2 }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.store:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\StoreConnector
        parent: oro_magento.connector.abstract
        calls:
            - [setClassName, ['Oro\Bundle\MagentoBundle\Entity\Store']]
        tags:
            - { name: oro_integration.connector, type: store_dictionary, channel_type: magento }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.rest.store:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\Rest\StoreConnector
        parent: oro_magento.connector.abstract
        calls:
            - [setClassName, ['Oro\Bundle\MagentoBundle\Entity\Store']]
        tags:
            - { name: oro_integration.connector, type: store_dictionary, channel_type: magento2 }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.customer_group:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\CustomerGroupConnector
        parent: oro_magento.connector.abstract
        calls:
            - [setClassName, ['Oro\Bundle\MagentoBundle\Entity\CustomerGroup']]
        tags:
            - { name: oro_integration.connector, type: customer_group_dictionary, channel_type: magento }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.order_connector_initial:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\InitialOrderConnector
        parent: oro_magento.mage.order_connector
        calls:
            - [setClassName, ['Oro\Bundle\MagentoBundle\Entity\Order']]
        tags:
            - { name: oro_integration.connector, type: order_initial, channel_type: magento }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.cart_connector_initial:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\InitialCartConnector
        parent: oro_magento.mage.cart_connector
        calls:
            - [setClassName, ['Oro\Bundle\MagentoBundle\Entity\Cart']]
        tags:
            - { name: oro_integration.connector, type: cart_initial, channel_type: magento }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.customer_connector_initial:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\InitialCustomerConnector
        parent: oro_magento.mage.customer_connector
        calls:
            - [setClassName, ['Oro\Bundle\MagentoBundle\Entity\Customer']]
        tags:
            - { name: oro_integration.connector, type: customer_initial, channel_type: magento }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.newsletter_subscriber_connector_initial:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\InitialNewsletterSubscriberConnector
        parent: oro_magento.mage.newsletter_subscriber_connector
        tags:
            - { name: oro_integration.connector, type: newsletter_subscriber_initial, channel_type: magento }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.customer_connector:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\CustomerConnector
        parent: oro_magento.connector.abstract
        tags:
            - { name: oro_integration.connector, type: customer, channel_type: magento }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.cart_connector:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\CartConnector
        public: true
        parent: oro_magento.connector.abstract
        tags:
            - { name: oro_integration.connector, type: cart, channel_type: magento }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.order_connector:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\OrderConnector
        parent: oro_magento.connector.abstract
        tags:
            - { name: oro_integration.connector, type: order, channel_type: magento }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.credit_memo_connector:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\CreditMemoConnector
        parent: oro_magento.connector.abstract
        tags:
            - { name: oro_integration.connector, type: credit_memo, channel_type: magento }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.credit_memo_connector_initial:
        class: 'Oro\Bundle\MagentoBundle\Provider\Connector\InitialCreditMemoConnector'
        parent: oro_magento.mage.credit_memo_connector
        calls:
            - [setClassName, ['Oro\Bundle\MagentoBundle\Entity\CreditMemo']]
        tags:
            - { name: oro_integration.connector, type: credit_memo_initial, channel_type: magento }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.region_connector:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\RegionConnector
        parent: oro_magento.connector.abstract
        tags:
            - { name: oro_integration.connector, type: region_dictionary, channel_type: magento }
            - { name: oro_integration.connector, type: region_dictionary, channel_type: magento2 }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.mage.newsletter_subscriber_connector:
        class: Oro\Bundle\MagentoBundle\Provider\Connector\NewsletterSubscriberConnector
        parent: oro_magento.connector.abstract
        calls:
            - [setClassName, ['Oro\Bundle\MagentoBundle\Entity\NewsletterSubscriber']]
        tags:
            - { name: oro_integration.connector, type: newsletter_subscriber, channel_type: magento }
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    # Normalizers / Denormalizers
    oro_magento.importexport.denormalizer.order:
        class: Oro\Bundle\MagentoBundle\ImportExport\Serializer\Normalizer\PaymentDetailsNormalizer
        parent: oro_importexport.serializer.configurable_entity_normalizer
        calls:
            - [setSupportedClass, ['Oro\Bundle\MagentoBundle\Entity\Order']]
        tags:
            - { name: oro_importexport.normalizer }

    oro_magento.importexport.denormalizer.region:
        class: Oro\Bundle\MagentoBundle\ImportExport\Serializer\RegionDenormalizer
        tags:
            - { name: oro_importexport.normalizer }

    oro_magento.importexport.normalizer.cart:
        class: Oro\Bundle\MagentoBundle\ImportExport\Serializer\Normalizer\PaymentDetailsNormalizer
        parent: oro_importexport.serializer.configurable_entity_normalizer
        calls:
            - [setSupportedClass, ['Oro\Bundle\MagentoBundle\Entity\Cart']]
        tags:
            - { name: oro_importexport.normalizer }

    oro_magento.importexport.denormalizer.order_item:
        class: Oro\Bundle\MagentoBundle\ImportExport\Serializer\OrderItemDenormalizer
        parent: oro_importexport.serializer.configurable_entity_normalizer
        tags:
            - { name: oro_importexport.normalizer }

    oro_magento.importexport.denormalizer.default_configurable_entity:
        class: Oro\Bundle\MagentoBundle\ImportExport\Serializer\DefaultConfigurableEntityDenormalizer
        arguments:
            - "@oro_entity.helper.field_helper"
            - "@logger"
        tags:
            - { name: oro_importexport.normalizer, priority: -200 }

    oro_magento.importexport.denormalizer.credit_memo:
        class: Oro\Bundle\MagentoBundle\ImportExport\Serializer\Normalizer\PaymentDetailsNormalizer
        parent: oro_importexport.serializer.configurable_entity_normalizer
        calls:
            - [setSupportedClass, ['Oro\Bundle\MagentoBundle\Entity\CreditMemo']]
        tags:
            - { name: oro_importexport.normalizer }

    # Strategies
    oro_magento.import_strategy.default_magento_import:
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\DefaultMagentoImportStrategy
        parent: oro_importexport.strategy.configurable_add_or_replace
        calls:
            - [setPropertyAccessor, ["@property_accessor"]]

    oro_magento.import.strategy.abstract:
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\AbstractImportStrategy
        parent: oro_magento.import_strategy.default_magento_import
        abstract: true
        calls:
            - [setLogger, ["@oro_integration.logger.strategy"]]
            - [setOwnerHelper, ["@oro_integration.helper.default_owner_helper"]]
            - [setAddressHelper, ["@oro_magento.importexport.address_import_helper"]]
            - [setChannelHelper, ["@oro_channel.importexport.helper.channel"]]

    oro_magento.import.strategy.customer.add_or_update:
        parent: oro_magento.import.strategy.abstract
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\CustomerStrategy
        calls:
            - [setChannelHelper, ["@oro_channel.importexport.helper.channel"]]
            - [setAddressHelper, ["@oro_magento.importexport.address_import_helper"]]

    oro_magento.import.strategy.newsletter_subscriber.add_or_update:
        parent: oro_magento.import.strategy.abstract
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\NewsletterSubscriberStrategy

    oro_magento.import.strategy.guest_customer.add_or_update:
        parent: oro_magento.import.strategy.abstract
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\GuestCustomerStrategy
        calls:
            - [setGuestCustomerStrategyHelper, ["@oro_magento.importexport.guest_customer_strategy_helper"]]

    oro_magento.import.strategy.region.add_or_update:
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\RegionStrategy
        parent: oro_magento.import.strategy.abstract
        calls:
            - [setDoctrineHelper, ["@oro_magento.importexport.doctrine_helper"]]

    oro_magento.import.strategy.store:
        parent: oro_magento.import_strategy.default_magento_import

    oro_magento.import.strategy.website:
        parent: oro_magento.import_strategy.default_magento_import

    oro_magento.import.strategy.customer_group:
        parent: oro_magento.import_strategy.default_magento_import

    oro_magento.import.strategy.cart.add_or_update:
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\CartStrategy
        parent: oro_magento.import.strategy.abstract
        calls:
            - [setGuestCustomerStrategyHelper, ["@oro_magento.importexport.guest_customer_strategy_helper"]]

    oro_magento.import.strategy.order.add_or_update:
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\OrderStrategy
        parent: oro_magento.import.strategy.abstract
        calls:
            - [setGuestCustomerStrategyHelper, ["@oro_magento.importexport.guest_customer_strategy_helper"]]
            - [setOrderNotesProcessor, ["@oro_magento.importexport.processor.order_notes.chain_processor"]]

    oro_magento.import.strategy.order_with_customer.add_or_update:
        parent: oro_magento.import.strategy.order.add_or_update
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\OrderWithExistingCustomerStrategy

    oro_magento.import.strategy.cart_with_customer.add_or_update:
        parent: oro_magento.import.strategy.cart.add_or_update
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\CartWithExistingCustomerStrategy

    oro_magento.import_strategy.newsletter_subscriber_with_customer.add_or_update:
        parent: oro_magento.import.strategy.newsletter_subscriber.add_or_update
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\NewsletterSubscriberWithExistingCustomerStrategy

    oro_magento.import.strategy.customer_address.add_or_update:
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\CustomerAddressStrategy
        parent: oro_magento.import.strategy.abstract

    oro_magento.import.strategy.credit_memo.add_or_update:
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\CreditMemoStrategy
        parent: oro_magento.import.strategy.abstract
        calls:
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\CreditMemo']]

    oro_magento.import.strategy.credit_memo_with_order.add_or_update:
        class: Oro\Bundle\MagentoBundle\ImportExport\Strategy\CreditMemoWithExistingOrderStrategy
        parent: oro_magento.import.strategy.credit_memo.add_or_update

    # Processors
    oro_magento.importexport.processor.import_newsletter_subscriber:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.newsletter_subscriber"]]
            - [setStrategy, ["@oro_magento.import.strategy.newsletter_subscriber.add_or_update"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\NewsletterSubscriber']]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\NewsletterSubscriber', alias: oro_magento.add_or_update_newsletter_subscriber }

    oro_magento.importexport.processor.import_customer:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.customer"]]
            - [setStrategy, ["@oro_magento.import.strategy.customer.add_or_update"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\Customer']]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\Customer', alias: oro_magento.add_or_update_customer }

    oro_magento.importexport.processor.import_guest_customer:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.guest_customer"]]
            - [setStrategy, ["@oro_magento.import.strategy.guest_customer.add_or_update"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\Customer']]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\Customer', alias: oro_magento.import_guest_customer }

    oro_magento.importexport.processor.import_customer_address:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.customer_address"]]
            - [setStrategy, ["@oro_magento.import.strategy.customer_address.add_or_update"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\Address']]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\Address', alias: oro_magento.add_or_update_customer_address }

    oro_magento.importexport.processor.import_region:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_importexport.data_converter.default"]]
            - [setStrategy, ["@oro_magento.import.strategy.region.add_or_update"]]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\Region', alias: oro_magento.add_or_update_region }

    oro_magento.importexport.processor.import_cart:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.cart"]]
            - [setStrategy, ["@oro_magento.import.strategy.cart.add_or_update"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\Cart']]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\Cart', alias: oro_magento.add_or_update_cart }

    oro_magento.importexport.processor.import_order:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.order"]]
            - [setStrategy, ["@oro_magento.import.strategy.order.add_or_update"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\Order']]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\Order', alias: oro_magento.add_or_update_order }

    oro_magento.importexport.processor.import_order_with_customer:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.order"]]
            - [setStrategy, ["@oro_magento.import.strategy.order_with_customer.add_or_update"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\Order']]
            - [setContextRegistry, ["@oro_importexport.context_registry"]]

    oro_magento.importexport.processor.import_cart_with_customer:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.cart"]]
            - [setStrategy, ["@oro_magento.import.strategy.cart_with_customer.add_or_update"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\Cart']]
            - [setContextRegistry, ["@oro_importexport.context_registry"]]

    oro_magento.importexport.processor.import_newsletter_subscriber_with_customer:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.newsletter_subscriber"]]
            - [setStrategy, ["@oro_magento.import_strategy.newsletter_subscriber_with_customer.add_or_update"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\NewsletterSubscriber']]
            - [setContextRegistry, ["@oro_importexport.context_registry"]]

    oro_magento.importexport.processor.order_notes.validation_note_processor:
        class: Oro\Bundle\MagentoBundle\ImportExport\Processor\OrderNotes\ValidationNoteProcessor
        public: false
        arguments:
            - '@oro_importexport.strategy.import.helper'
            - '@oro_entity.doctrine_helper'

    oro_magento.importexport.processor.order_notes.note_fields_processor:
        class: Oro\Bundle\MagentoBundle\ImportExport\Processor\OrderNotes\NoteFieldsProcessor
        public: false
        arguments:
            - '@oro_ui.html_tag_helper'

    oro_magento.importexport.processor.order_notes.chain_processor:
        class: Oro\Bundle\MagentoBundle\ImportExport\Processor\OrderNotes\ChainProcessor
        public: false
        calls:
            - [addProcessor, ['@oro_magento.importexport.processor.order_notes.validation_note_processor']]
            - [addProcessor, ['@oro_magento.importexport.processor.order_notes.note_fields_processor']]

    oro_magento.importexport.normalizer.datetime:
        class: Oro\Bundle\MagentoBundle\ImportExport\Serializer\Normalizer\DateTimeNormalizer
        tags:
            - { name: oro_importexport.normalizer }

    oro_magento.provider.sync.processor:
        class: Oro\Bundle\MagentoBundle\Provider\MagentoSyncProcessor
        parent: oro_integration.sync.processor
        abstract: true
        tags:
            - { name: oro_magento.bundle_config.aware }
        calls:
            - [setChannelClassName, ['Oro\Bundle\IntegrationBundle\Entity\Channel']]

    oro_magento.provider.initial_processor:
        class: Oro\Bundle\MagentoBundle\Provider\AbstractInitialProcessor
        parent: oro_magento.provider.sync.processor
        abstract: true

    oro_magento.provider.newsletter_subscriber.initial_sync_processor:
        class: Oro\Bundle\MagentoBundle\Provider\NewsletterSubscriberInitialSyncProcessor
        parent: oro_magento.provider.initial_processor

    oro_magento.provider.initial_sync_processor:
        class: Oro\Bundle\MagentoBundle\Provider\InitialSyncProcessor
        parent: oro_magento.provider.initial_processor
        calls:
            - [addPostProcessor, ['newsletter_subscriber_initial', "@oro_magento.provider.newsletter_subscriber.initial_sync_processor"]]
        tags:
            - { name: oro_magento.bundle_config.aware }

    oro_magento.provider.initial_schedule_processor:
        class: Oro\Bundle\MagentoBundle\Provider\InitialScheduleProcessor
        parent: oro_magento.provider.initial_processor
        calls:
            - [setDoctrineHelper, ["@oro_entity.doctrine_helper"]]
            - [setMessageProducer, ["@oro_message_queue.message_producer"]]
        tags:
            - { name: oro_integration.sync_processor, integration: magento }
            - { name: oro_integration.sync_processor, integration: magento2 }

    oro_magento.importexport.processor.context:
        class: Oro\Bundle\MagentoBundle\ImportExport\Processor\ContextProcessor
        parent: oro_integration.importexport.processor.import

    oro_magento.importexport.processor.context_order:
        parent: oro_magento.importexport.processor.context
        calls:
            - [setStrategy, ["@oro_magento.import.strategy.order.add_or_update"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\Order']]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\Order', alias: oro_magento.order_context }

    oro_magento.importexport.processor.context_cart:
        parent: oro_magento.importexport.processor.context
        calls:
            - [setStrategy, ["@oro_magento.import.strategy.cart.add_or_update"]]

    oro_magento.importexport.processor.context_credit_memo:
        parent: oro_magento.importexport.processor.context
        calls:
            - [setStrategy, ["@oro_magento.import.strategy.credit_memo.add_or_update"]]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\CreditMemo', alias: oro_magento.credit_memo_context }

    oro_magento.importexport.processor.context_newsletter_subscriber:
        parent: oro_magento.importexport.processor.context
        calls:
            - [setStrategy, ["@oro_magento.import.strategy.newsletter_subscriber.add_or_update"]]

    oro_magento.importexport.processor.store:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.store"]]
            - [setStrategy, ["@oro_magento.import.strategy.store"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\Store']]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\Store', alias: oro_magento.store }

    oro_magento.importexport.processor.rest.store:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.rest.store"]]
            - [setStrategy, ["@oro_magento.import.strategy.store"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\Store']]

    oro_magento.importexport.processor.website:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.website"]]
            - [setStrategy, ["@oro_magento.import.strategy.website"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\Website']]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\Website', alias: oro_magento.website }

    oro_magento.importexport.processor.rest.website:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.website"]]
            - [setStrategy, ["@oro_magento.import.strategy.website"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\Website']]

    oro_magento.importexport.processor.customer_group:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.customer_group"]]
            - [setStrategy, ["@oro_magento.import.strategy.customer_group"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\CustomerGroup']]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\CustomerGroup', alias: oro_magento.customer_group }

    oro_magento.importexport.processor.import_credit_memo:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.credit_memo"]]
            - [setStrategy, ["@oro_magento.import.strategy.credit_memo.add_or_update"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\CreditMemo']]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\CreditMemo', alias: oro_magento.add_or_update_credit_memo }

    oro_magento.importexport.processor.import_credit_memo_with_existing_order:
        parent: oro_integration.importexport.processor.import
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.credit_memo"]]
            - [setStrategy, ["@oro_magento.import.strategy.credit_memo_with_order.add_or_update"]]
            - [setEntityName, ['Oro\Bundle\MagentoBundle\Entity\CreditMemo']]
        tags:
            - { name: oro_importexport.processor, type: import, entity: 'Oro\Bundle\MagentoBundle\Entity\CreditMemo', alias: oro_magento.add_or_update_credit_memo_with_existing_order }

    # Export processor
    oro_magento.importexport.processor.customer_export:
        parent: oro_integration.importexport.processor.export
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.customer"]]
        tags:
            - { name: oro_importexport.processor, type: export, entity: 'Oro\Bundle\MagentoBundle\Entity\Customer', alias: oro_magento.customer_export }

    oro_magento.importexport.processor.customer_address_export:
        parent: oro_integration.importexport.processor.export
        calls:
             - [setDataConverter, ["@oro_magento.importexport.data_converter.customer_address"]]

    oro_magento.importexport.processor.customer_address_export.job:
        class: Oro\Bundle\MagentoBundle\ImportExport\Processor\CustomerAddressExportProcessor
        parent: oro_integration.importexport.processor.export
        calls:
             - [setDataConverter, ["@oro_magento.importexport.data_converter.customer_address"]]
             - [setStateHandler, ["@oro_magento.customer_state_handler"]]
             - [setTransport, ["@oro_magento.transport.soap_transport"]]
        tags:
            - { name: oro_importexport.processor, type: export, entity: 'Oro\Bundle\MagentoBundle\Entity\Address', alias: oro_magento.customer_address_export }

    oro_magento.importexport.processor.newsletter_subscriber_export:
        parent: oro_integration.importexport.processor.export
        calls:
            - [setDataConverter, ["@oro_magento.importexport.data_converter.newsletter_subscriber"]]
        tags:
            - { name: oro_importexport.processor, type: export, entity: 'Oro\Bundle\MagentoBundle\Entity\NewsletterSubscriber', alias: oro_magento.newsletter_subscriber_export }

    # Writers
    oro_magento.writer.proxy_entity_writer:
        class: Oro\Bundle\MagentoBundle\ImportExport\Writer\ProxyEntityWriter
        arguments:
            - "@oro_integration.writer.persistent_batch_writer"
            - "@oro_importexport.field.database_helper"
        calls:
            - [setLogger, ["@oro_integration.logger.strategy"]]
            - [setGuestCustomerStrategyHelper, ["@oro_magento.importexport.guest_customer_strategy_helper"]]

    oro_magento.importexport.writer.abstract_export:
        class: Oro\Bundle\MagentoBundle\ImportExport\Writer\AbstractExportWriter
        parent: oro_integration.writer.persistent_batch_writer
        abstract: true
        calls:
            - [setTransport, ["@oro_magento.transport.soap_transport"]]
            - [setChannelClassName, ['Oro\Bundle\IntegrationBundle\Entity\Channel']]

    oro_magento.importexport.writer.customer:
        class: Oro\Bundle\MagentoBundle\ImportExport\Writer\CustomerExportWriter
        parent: oro_magento.importexport.writer.abstract_export
        calls:
            - [setStrategy, ["@oro_magento.provider.strategy.two_way_sync.customer"]]
            - [setStateHandler, ["@oro_magento.customer_state_handler"]]

    oro_magento.importexport.writer.customer_address:
        class: Oro\Bundle\MagentoBundle\ImportExport\Writer\CustomerAddressExportWriter
        parent: oro_magento.importexport.writer.abstract_export
        calls:
            - [setMagentoRegionClass, ['Oro\Bundle\MagentoBundle\Entity\Region']]
            - [setStrategy, ["@oro_magento.provider.strategy.two_way_sync.customer_address"]]
            - [setStateHandler, ["@oro_magento.customer_state_handler"]]

    oro_magento.importexport.writer.newsletter_subscriber:
        class: Oro\Bundle\MagentoBundle\ImportExport\Writer\NewsletterSubscriberExportWriter
        parent: oro_magento.importexport.writer.abstract_export

    oro_magento.importexport.writer.initial_sync.newsletter_subscriber:
        class: Oro\Bundle\MagentoBundle\ImportExport\Writer\NewsletterSubscriberInitialWriter
        parent: oro_magento.writer.proxy_entity_writer

    # readers
    oro_magento.importexport.reader.entity:
        class: Oro\Bundle\MagentoBundle\Provider\Reader\ContextOptionReader
        parent: oro_magento.reader.context
        calls:
            - [setContextKey, ['entity']]

    oro_magento.reader.context_customer:
        class: Oro\Bundle\MagentoBundle\Provider\Reader\ContextCustomerReader
        parent: oro_magento.mage.customer_connector
        tags:
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.reader.context_customer.order:
        parent: oro_magento.reader.context_customer

    oro_magento.reader.context_customer.cart:
        parent: oro_magento.reader.context_customer

    oro_magento.reader.context_customer.newsletter_subscriber:
        parent: oro_magento.reader.context_customer

    oro_magento.reader.context_cart.order:
        class: Oro\Bundle\MagentoBundle\Provider\Reader\ContextCartReader
        parent: oro_magento.mage.cart_connector
        tags:
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.reader.context_order.credit_memo:
        class: Oro\Bundle\MagentoBundle\Provider\Reader\ContextOrderReader
        parent: oro_magento.mage.order_connector
        tags:
            - { name: oro_magento.bundle_config.aware, argument_number: 3 }

    oro_magento.reader.context:
        class: Oro\Bundle\MagentoBundle\Provider\Reader\ContextReader
        abstract: true
        arguments:
            - "@oro_importexport.context_registry"

    oro_magento.reader.context_guest_customer:
        parent: oro_magento.reader.context
        calls:
            - [setContextKey, ['postProcessGuestCustomers']]

    oro_magento.reader.context_order:
        parent: oro_magento.reader.context
        calls:
            - [setContextKey, ['postProcessOrders']]

    oro_magento.reader.context_credit_memo:
        parent: oro_magento.reader.context
        calls:
            - [setContextKey, ['postProcessCreditMemos']]

    oro_magento.reader.context_customer_export:
        parent: oro_magento.reader.context
        calls:
            - [setContextKey, ['postProcessCustomer']]

    oro_magento.reader.context_customer_address_export:
        parent: oro_magento.reader.context
        calls:
            - [setContextKey, ['postProcessCustomerAddress']]

    oro_magento.reader.context_cart:
        parent: oro_magento.reader.context
        calls:
            - [setContextKey, ['postProcessCarts']]

    oro_magento.reader.context_newsletter_subscriber:
        parent: oro_magento.reader.context
        calls:
            - [setContextKey, ['postProcessSubscribers']]

    oro_magento.reader.context_newsletter_subscriber_export:
        parent: oro_magento.reader.context
        calls:
            - [setContextKey, ['postProcessNewsletterSubscribers']]

    oro_magento.reader.order_info:
        class: Oro\Bundle\MagentoBundle\Provider\Reader\OrderInfoReader
        arguments:
            - "@oro_importexport.context_registry"
            - "@oro_integration.logger.strategy"
            - "@oro_integration.provider.connector_context_mediator"
        calls:
            - [setContextKey, ['postProcessOrderIds']]

    oro_magento.reader.customer_info:
        class: Oro\Bundle\MagentoBundle\Provider\Reader\CustomerInfoReader
        arguments:
            - "@oro_importexport.context_registry"
            - "@oro_integration.logger.strategy"
            - "@oro_integration.provider.connector_context_mediator"
        calls:
            - [setContextKey, ['postProcessCustomerIds']]

    oro_magento.reader.credit_memo_info:
        class: Oro\Bundle\MagentoBundle\Provider\Reader\CreditMemoInfoReader
        arguments:
            - "@oro_importexport.context_registry"
            - "@oro_integration.logger.strategy"
            - "@oro_integration.provider.connector_context_mediator"
        calls:
            - [setContextKey, ['postProcessCreditMemoIds']]

    # strategy
    oro_magento.provider.strategy.two_way_sync.customer:
        class: Oro\Bundle\MagentoBundle\Provider\Strategy\TwoWaySyncStrategy
        arguments:
            - "@oro_magento.importexport.processor.import_customer"
            - "@oro_magento.importexport.processor.customer_export"
            - "@oro_entity.doctrine_helper"

    oro_magento.provider.strategy.two_way_sync.customer_address:
        class: Oro\Bundle\MagentoBundle\Provider\Strategy\TwoWaySyncStrategy
        arguments:
            - "@oro_magento.importexport.processor.import_customer_address"
            - "@oro_magento.importexport.processor.customer_address_export"
            - "@oro_entity.doctrine_helper"

    oro_magento.importexport.data_converter.abstract_address:
        abstract: true
        class: Oro\Bundle\MagentoBundle\ImportExport\Converter\AbstractAddressDataConverter
        calls:
            - [setIso2CodeProvider, ['@oro_magento.provider.iso2_code']]

    # utils
    oro_magento.post_job_executor:
        class: Oro\Bundle\MagentoBundle\ImportExport\Job\PostJobExecutor
        parent: oro_importexport.job_executor
